{% extends 'base.html' %}
{% load filtros %}
{% load user_agents %}

{% block header %}

  <div class="header-gradient">
    <div class="row justify-content-center align-items-center">
      <div class="col-8">
        <h4 class="text-primary">RELATÓRIOS</h4>
      </div>
      <div class="col-4">
        {% if relatorios_em_aberto %}
          {% if relatorios_em_aberto.0.estado == 'justificativas' %}
            <form action="{% url 'soma_horas' %}" method="GET">
              <button class="btn btn-sm btn-block btn-primary" type="submit" {% if not user|has_group:'relatorio' %}disabled{% endif %}>
                Concluir Relatórios
              </button>
            </form>

          {% else %}
            {% include 'modals/finalizar_relatorio.html' %}
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>

{% endblock %}

{% block conteudo %}

  {% if relatorios_finalizados|length == 0 and relatorios_em_aberto|length == 0 %}
    <div class="row justify-content-center align-items-center">
      <div class="col-12 text-center">
        {% if qtd_trabalhadores > 0 %}
          <a class="btn btn-lg btn-success text-center mb-5" href="{% url 'soma_horas' %}" {% if not user|has_group:'relatorio' %}disabled{% endif %}>Começar a somar as justificativas</a>
        {% else %}
          <h5 class="text-success">Primeiramente, cadastre setores, e então trabalhadores</h5>
        {% endif %}
      </div>
    </div>
  {% elif relatorios_finalizados|length > 0 and relatorios_em_aberto|length == 0 %}
    <small class="text-danger">Relatório(s) de {{ relatorios_finalizados.0.mes|mes_escrito }} já fechado(s)</small>
  {% else %}
      <h5 class="text-success">O(s) relatório(s) deste mês já foram fechados</h5>
  {% endif %}

  {% if relatorios_finalizados or relatorios_em_aberto or relatorios_finalizados_antigos %}
    <div class="m-3 my-5 text-center">
      {% if relatorios_finalizados_antigos %}

        <div class='row justify-content-center text-center'>
          <div class='col-12 wrapper-label display-4'>
            <p class='text-center'>
              Antigos
            </p>
          </div>

          <div class='col-12 relatorio-wrapper'>
            <div class='row justify-content-center'>


              {% for referencia in relatorios_finalizados_antigos|get_referencias %}
                <div class='col-6 col-lg-3'>
                  <p>
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseRelatoriosFinalizadosAntigos" aria-expanded="false" aria-controls="collapseRelatoriosFinalizadosAntigos">
                      {{ referencia }}
                    </button>
                  </p>
                  <div class="collapse" id="collapseRelatoriosFinalizadosAntigos">
                    <div class="card card-body rounded">
                      <div class='row justify-content-center'>
                        {% for relatorio in relatorios_finalizados_antigos %}
                          <div class='col-12 col-lg-6 text-center'>
                            {% include 'modals/relatorio.html' %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>
        </div>
      {% endif %}

      {% if relatorios_finalizados %}

        <div class='row justify-content-center text-center'>

          <div class='col-12 wrapper-label display-4'>
            <p class='text-center'>
              Finalizados
            </p>
          </div>

          <div class='col-12 relatorio-wrapper'>
            <div class='row justify-content-center'>


              {% for referencia in relatorios_finalizados|get_referencias %}
                <div class='col-6 col-lg-3'>
                  <p>
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseRelatoriosFinalizados" aria-expanded="false" aria-controls="collapseRelatoriosFinalizados">
                      {{ referencia }}
                    </button>
                  </p>
                  <div class="collapse" id="collapseRelatoriosFinalizados">
                    <div class="card card-body rounded">
                      <div class='row justify-content-center'>
                        {% for relatorio in relatorios_finalizados %}
                          <div class='col-12 col-lg-6 text-center'>
                            {% include 'modals/relatorio.html' %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>
        </div>

      {% endif %}

      {% if relatorios_em_aberto %}


        <div class='row justify-content-center text-center'>

          <div class='col-12 wrapper-label display-4'>
            <p class='text-center'>
              Em Aberto
            </p>
          </div>

          <div class='col-12 relatorio-wrapper'>
            <div class='row justify-content-center'>


              {% for referencia in relatorios_em_aberto|get_referencias %}
                <div class='col-6 col-lg-3'>
                  <p>
                    <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#collapseRelatoriosEmAberto" aria-expanded="false" aria-controls="collapseRelatoriosEmAberto">
                      {{ referencia }}
                    </button>
                  </p>
                  <div class="collapse" id="collapseRelatoriosEmAberto">
                    <div class="card card-body rounded">
                      <div class='row justify-content-center'>
                        {% for relatorio in relatorios_em_aberto %}
                          <div class='col-12 col-lg-6 text-center'>
                            {% include 'modals/relatorio.html' %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>
        </div>
        

      {% endif %}
    </div>

  {% endif  %}
  {% if relatorios_em_aberto or relatorios_finalizados or relatorios_finalizados_antigos %}
    <br class="my-4">
  {% endif %}


{% endblock %}
